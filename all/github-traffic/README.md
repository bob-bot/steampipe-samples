# GitHub traffic for a set of repos

This dashboard reports data from [github_traffic_view_daily](https://hub.steampipe.io/plugins/turbot/github/tables/github_traffic_view_daily) as a set of Tuftean [small multiples](https://www.juiceanalytics.com/writing/better-know-visualization-small-multiples) that summarize the last 14 days of GitHub traffic to Steampipe plugins and mods. 

- Repos with negligible traffic are excluded.

- Repos are sorted in descending order by the sum of daily uniques for the 2-week period.

- Daily maxes are scaled to the biggest day for each type of chart (plugin or mod).

# Implementation

The HCL+SQL code in `mod.sp` is not complicated, but it would be impractical to write by hand. Instead, it's generated by a Python script. 

You could write that script in the conventional way, using `psycopg2` to connect Python to Steampipe. Or as per ../github-avatars you could use SQL to produce CSV output that's further transformed by Python. This example does things differently in order to show that it's possible to use Postgres' pl/python extension with Steampipe. `plpy-traffic-dashboard.sql` defines a Postgres procedure, `traffic()` that's written in Python. You run it from the Postgres command line: `call traffic()`.

The easiest way to install pl/python (or any other Postgres extension) into the Steampipe instance of Postgres is to copy files from another instance of Postgres where the extension was installed in the conventional way. 


```
sudo apt install postgres-plpython3-14

cp /usr/lib/postgresql/14/lib/plpython3.so ~/.steampipe/db/14.2.0/postgres/lib/postgresql/plpython3.so

sudo -u root psql -d steampipe -h localhost -p 9193

=# create extension plpython3u

=# update pg_language set lanpltrusted = true where lanname = 'plpython3u';

=# grant all on language plpython3u to steampipe;
```

(https://stackoverflow.com/questions/2848704/postgresql-running-python-stored-procedures-as-a-normal-user)
